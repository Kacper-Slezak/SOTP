# Makefile dla projektu SOTP
# UÅ¼ywa gÅ‚Ã³wnie Docker Compose, aby zapewniÄ‡ spÃ³jnoÅ›Ä‡ miÄ™dzy systemami.

# Definicje plikÃ³w docker-compose dla rÃ³Å¼nych Å›rodowisk
DC_DEV = docker-compose -f infrastructure/docker/docker-compose.dev.yml
DC_PROD = docker-compose -f infrastructure/docker/docker-compose.prod.yml

# DomyÅ›lna komenda, ktÃ³ra uruchomi siÄ™ po wpisaniu 'make'
.DEFAULT_GOAL := help

# Deklaracja komend, ktÃ³re nie sÄ… plikami
.PHONY: help setup dev down logs test build deploy backup restore

help:
	@echo "DostÄ™pne komendy dla projektu SOTP:"
	@echo ""
	@echo "  make help          -> WyÅ›wietla tÄ™ pomoc."
	@echo "  make setup         -> Buduje obrazy Docker, potrzebne do startu (uruchom raz na poczÄ…tku)."
	@echo "  make dev           -> Uruchamia Å›rodowisko deweloperskie w tle."
	@echo "  make down          -> Zatrzymuje i usuwa kontenery deweloperskie."
	@echo "  make logs          -> WyÅ›wietla logi wszystkich uruchomionych usÅ‚ug."
	@echo "  make test          -> Uruchamia testy backendu w dedykowanym kontenerze."
	@echo "  make build         -> Buduje produkcyjne obrazy Docker."
	[cite_start]@echo "  make deploy        -> Symuluje wdroÅ¼enie na produkcjÄ™ (placeholder)." [cite: 1]
	[cite_start]@echo "  make backup        -> Uruchamia skrypt do backupu bazy danych (placeholder)." [cite: 1]
	[cite_start]@echo "  make restore       -> Uruchamia skrypt do odtworzenia bazy z backupu (placeholder)." [cite: 1]
	@echo ""

# Buduje obrazy deweloperskie, --no-cache zapewnia Å›wieÅ¼Ä… instalacjÄ™ zaleÅ¼noÅ›ci
setup:
	@echo "ğŸ› ï¸  Budowanie obrazÃ³w deweloperskich..."
	$(DC_DEV) build --no-cache

# Uruchamia Å›rodowisko deweloperskie w tle (-d)
dev:
	@echo "ğŸš€  Uruchamianie Å›rodowiska deweloperskiego..."
	$(DC_DEV) up -d

# Zatrzymuje i usuwa kontenery, sieci oraz wolumeny
down:
	@echo "âœ‹  Zatrzymywanie Å›rodowiska deweloperskiego..."
	$(DC_DEV) down

# WyÅ›wietla i Å›ledzi (-f) logi wszystkich kontenerÃ³w
logs:
	@echo "ğŸ“œ  WyÅ›wietlanie logÃ³w..."
	$(DC_DEV) logs -f

# Uruchamia testy backendu w nowym, tymczasowym kontenerze (--rm)
test:
	@echo "ğŸ§ª  Uruchamianie testÃ³w backendu..."
	$(DC_DEV) run --rm backend pytest

# Buduje obrazy produkcyjne
build:
	@echo "ğŸ“¦  Budowanie obrazÃ³w produkcyjnych..."
	$(DC_PROD) build

# Placeholder dla komendy wdroÅ¼enia
deploy:
	@echo "ğŸš¢  Symulacja wdroÅ¼enia na produkcjÄ™..."
	$(DC_PROD) up -d

# Placeholder dla komendy backupu
backup:
	@echo "ğŸ’¾  Uruchamianie backupu..."
	@echo "Tutaj zostanie wywoÅ‚any skrypt 'scripts/backup.sh'"

# Placeholder dla komendy odtwarzania
restore:
	@echo "ğŸ”„  Odtwarzanie z backupu..."
	@echo "Tutaj zostanie wywoÅ‚any skrypt 'scripts/restore.sh'"