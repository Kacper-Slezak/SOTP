# Makefile dla projektu SOTP - Wersja Hybrydowa (VENV + Docker)

.PHONY: help setup dev-backend dev-frontend test build push deploy

help:
	@echo "DostÄ™pne komendy dla projektu SOTP (tryb hybrydowy):"
	@echo ""
	@echo "--- Development (Lokalnie z VENV) ---"
	@echo "  make setup         -> Instaluje zaleÅ¼noÅ›ci w lokalnych Å›rodowiskach (venv/npm)."
	@echo "  make dev-backend   -> Uruchamia serwer backendu FastAPI lokalnie."
	@echo "  make dev-frontend  -> Uruchamia serwer frontendu Next.js lokalnie."
	@echo "  make test          -> Uruchamia testy backendu lokalnie."
	@echo ""
	@echo "--- Deployment (z Dockerem) ---"
	@echo "  make build         -> Buduje produkcyjne obrazy Docker."
	@echo "  make push          -> WysyÅ‚a zbudowane obrazy do repozytorium (np. Docker Hub)."
	@echo "  make deploy        -> Symuluje wdroÅ¼enie aplikacji na serwerze."
	@echo ""

# === Sekcja Development (VENV) ===
setup:
	@echo "ğŸ› ï¸  Instalowanie zaleÅ¼noÅ›ci backendu w venv..."
	(cd backend && python -m venv venv && . venv/Scripts/activate && pip install -r requirements.txt)
	@echo "ğŸ› ï¸  Instalowanie zaleÅ¼noÅ›ci frontendu z npm..."
	(cd frontend && npm install)
	@echo "âœ… Setup zakoÅ„czony. PamiÄ™taj, aby aktywowaÄ‡ venv dla backendu."

dev-backend:
	@echo "ğŸš€  Uruchamianie serwera backendu na http://localhost:8000"
	@echo "Upewnij siÄ™, Å¼e venv jest aktywne ('source backend/venv/Scripts/activate')"
	(cd backend && uvicorn app.main:app --reload)

dev-frontend:
	@echo "ğŸ¨  Uruchamianie serwera frontendu na http://localhost:3000"
	(cd frontend && npm run dev)

test:
	@echo "ğŸ§ª  Uruchamianie testÃ³w backendu..."
	@echo "Upewnij siÄ™, Å¼e venv jest aktywne ('source backend/venv/Scripts/activate')"
	(cd backend && pytest)

# === Sekcja Deployment (Docker) ===
build:
	@echo "ğŸ“¦  Budowanie produkcyjnych obrazÃ³w Docker..."
	docker-compose -f infrastructure/docker/docker-compose.prod.yml build

push:
	@echo "â«  WysyÅ‚anie obrazÃ³w do repozytorium..."
	docker-compose -f infrastructure/docker/docker-compose.prod.yml push

deploy:
	@echo "ğŸš¢  WdraÅ¼anie aplikacji na serwerze..."
	@echo "Ta komenda na serwerze produkcyjnym uruchomiÅ‚aby: docker-compose -f infrastructure/docker/docker-compose.prod.yml up -d"