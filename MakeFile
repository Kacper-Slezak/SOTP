# Makefile dla projektu SOTP - Wersja Hybrydowa (VENV + Docker)

.PHONY: help setup dev-backend dev-frontend test build push deploy

help:
	@echo "Dostępne komendy dla projektu SOTP (tryb hybrydowy):"
	@echo ""
	@echo "--- Development (Lokalnie z VENV) ---"
	@echo "  make setup         -> Instaluje zależności w lokalnych środowiskach (venv/npm)."
	@echo "  make dev-backend   -> Uruchamia serwer backendu FastAPI lokalnie."
	@echo "  make dev-frontend  -> Uruchamia serwer frontendu Next.js lokalnie."
	@echo "  make test          -> Uruchamia testy backendu lokalnie."
	@echo ""
	@echo "--- Deployment (z Dockerem) ---"
	@echo "  make build         -> Buduje produkcyjne obrazy Docker."
	@echo "  make push          -> Wysyła zbudowane obrazy do repozytorium (np. Docker Hub)."
	@echo "  make deploy        -> Symuluje wdrożenie aplikacji na serwerze."
	@echo ""

# === Sekcja Development (VENV) ===
setup:
	@echo "🛠️  Instalowanie zależności backendu w venv..."
	(cd backend && python -m venv venv && . venv/Scripts/activate && pip install -r requirements.txt)
	@echo "🛠️  Instalowanie zależności frontendu z npm..."
	(cd frontend && npm install)
	@echo "✅ Setup zakończony. Pamiętaj, aby aktywować venv dla backendu."

dev-backend:
	@echo "🚀  Uruchamianie serwera backendu na http://localhost:8000"
	@echo "Upewnij się, że venv jest aktywne ('source backend/venv/Scripts/activate')"
	(cd backend && uvicorn app.main:app --reload)

dev-frontend:
	@echo "🎨  Uruchamianie serwera frontendu na http://localhost:3000"
	(cd frontend && npm run dev)

test:
	@echo "🧪  Uruchamianie testów backendu..."
	@echo "Upewnij się, że venv jest aktywne ('source backend/venv/Scripts/activate')"
	(cd backend && pytest)

# === Sekcja Deployment (Docker) ===
build:
	@echo "📦  Budowanie produkcyjnych obrazów Docker..."
	docker-compose -f infrastructure/docker/docker-compose.prod.yml build

push:
	@echo "⏫  Wysyłanie obrazów do repozytorium..."
	docker-compose -f infrastructure/docker/docker-compose.prod.yml push

deploy:
	@echo "🚢  Wdrażanie aplikacji na serwerze..."
	@echo "Ta komenda na serwerze produkcyjnym uruchomiłaby: docker-compose -f infrastructure/docker/docker-compose.prod.yml up -d"